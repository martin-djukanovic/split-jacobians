/****** CASE 1 ******/
K<t>:=FunctionField(QQ);
A2<x,y>:=AffineSpace(K,2);
R<X>:=PolynomialRing(K);
h:=hom<CoordinateRing(A2)->R|[X,0]>;
C:=Curve(A2, - y^2 + x^6 + (-t^4 - 16*t^3 - 96*t^2 - 240*t - 162)*x^4 + (2*t^4 + 80*t^3 + 864*t^2 + 3888*t + 6561)*x^2 - t^4);
E:=Curve(A2,  - y^2 + x^3 - (t + 3)*(t + 9)*(t^2 - 27)*(t^2 + 9*t + 27)*(t^2 + 10*t + 27)*x^2 - t*(t + 3)*(t + 9)*(t^2 + 9*t + 27)^2*(2*t^4 + 63*t^3 + 540*t^2 + 1701*t + 1458)*(t^2 + 10*t + 27)^2*x - t^2*(t^2 - 27)^3*(t^2 + 9*t + 27)^3*(t^2 + 10*t + 27)^4);
E1:=Curve(A2, - y^2 + x^3 + (-t^4 - 16*t^3 - 96*t^2 - 240*t - 162)*x^2 + (2*t^4 + 80*t^3 + 864*t^2 + 3888*t + 6561)*x - t^4);
E2:=Curve(A2, - y^2 + x^3 + (2*t^4 + 80*t^3 + 864*t^2 + 3888*t + 6561)/t^4*x^2 + (t^4 + 16*t^3 + 96*t^2 + 240*t + 162)/t^4*x + 1/t^4);

f1:=map<C->E|[
 t*(t^2 + 9*t + 27)*(t^2 + 10*t + 27)^2*(x - 3)^2*((2*t + 9)*x - t*(t + 6))/(x^3 + (t^2 + 8*t + 18)*x^2 + (2*t^2 + 24*t + 81)*x + t^2),
  (2*t*(27 + 9*t + t^2)^3*(27 + 10*t + t^2)^2*((t + 4)*x^3 + (7*t + 36)*x^2 - (4*t^2 + 21*t)*x - 4*t^2 - 27*t)*y)/(x^3 + (t^2 + 8*t + 18)*x^2 + (2*t^2 + 24*t + 81)*x + t^2)^2
]>;
f2:=map<C->E|[
	t*(t^2 + 9*t + 27)*(t^2 + 10*t + 27)^2*(x + 3)^2* ((2 *t + 9) *x + t*(t + 6))/(x^3-(t^2 + 8*t + 18)*x^2 +(2*t^2 + 24*t + 81)*x - t^2), 
	2*t*(t^2 + 9*t + 27)^3*(t^2 + 10*t + 27)^2*y*((t + 4)*x^3 - (7*t +36)*x^2 - (4*t^2 + 21*t)*x + (4*t^2 + 27*t))/(x^3-(t^2 + 8*t + 18)*x^2 +(2*t^2 + 24*t + 81)*x - t^2)^2
]>;
g1:=map<C->E1|[x^2, y]>;
g2:=map<C->E2|[-1/x^2, 1/t^2*y/x^3]>;

E:=EllipticCurve(h(Basis(Ideal(E))[1]));
E1:=EllipticCurve(h(Basis(Ideal(E1))[1]));
E2:=EllipticCurve(h(Basis(Ideal(E2))[1]));
[jInvariant(e) : e in [E,E1,E2]] eq [
	((t + 3)^3*(t + 9)^3*(t^2 + 27)^3)/(t^3*(t^2 + 9*t + 27)^3),
	((t + 3)^3*(t^3 + 9*t^2 + 27*t + 3)^3)/(t*(t^2 + 9*t + 27)),
	((t + 9)^3*(t^3 + 243*t^2 + 2187*t + 6561)^3)/(t^9*(t^2 + 9*t + 27))
];

F,f:=IsogenyFromKernel(E1, X + 4*t + 27);
IsIsomorphic(F,E) and Degree(f) eq 3;

F:=IsogenyFromKernel(E2, 3*t*X - t - 4);
IsIsomorphic(F,E) and Degree(f) eq 3;




/****** CASE 2 ******/
R<x>:=PolynomialRing(QQ);
K<w>:=ext<QQ|x^2+x+1>;
K<t>:=FunctionField(K);
A2<x,y>:=AffineSpace(K,2);
C:=Curve(A2, -y^2 + (4*t*(t^2 - 6*t - 3)*x^3 - 3*w*(t^2 - 6*t - 3)*(t^2 - w*t - 3*w^2)*x^2 + 12*t*(t^2 + 3*w*t - 3*w^2)*x + 4*t*(t^2 + 3*t - 3)) * (4*(t^2 - 6*t - 3)*(t^2 + 3*t - 3)*x^3 + 9*(t^2 + 3*w*t - 3*w^2)^2*x^2 + 6*(t^2 + 3*t - 3)*(t^2 + 3*w*t - 3*w^2)*x + (t^2 + 3*t - 3)^2));
E1:=Curve(A2, -t*(t^2 - 6*t - 3)*y^2 + x^3 + 3*(t^2 + t*(1 - w) + 3*w)/(t^2 - t*(1 - w^2) + 3*w^2)*x^2 + 3*(t^6 - 2*(2 + w)*t^5 - 3*t^4*(5 - 2*w) + 18*t^3*w - 9*t^2*(5 + 7*w) + 18*t*(2 + w) + 27*(1 + w))/((t^2 - 6*t - 3)*(t^2 - t*(1 - w^2) + 3*w^2)^2)*x + (t^2 + 3*t - 3)/(t^2 - 6*t - 3));
E2:=Curve(A2, -t*(t^2 - 6*t - 3)*(t^2 + (w^2 - 1)*t + 3*w^2)*y^2 + x^3 + 3*(t^2 - (w^2 - 1)*t + 3*w^2)*x^2 + ((3*(t^6 - 2*(2 + w^2)*t^5 - 3*(5 - 2*w^2)*t^4 + 18*t^3*w^2 - 9*(5 + 7*w^2)*t^2 + 18*(2 + w^2)*t + 27*(1 + w^2)))/(t^2 - 6*t - 3))*x + (t^2 + (w - 1)*t + 3*w)^3*((t^2 + 3*t - 3)/(t^2 - 6*t - 3)));

// degree-3 coverings
f1:=map<C->E1|[
  3*w*(t^2 + (w^2 - 1)*t + 3*w^2)^2 * x^2/(4*t*(t^2 - 6*t - 3)*x^3 - 3*w*(t^2 - 6*t - 3)*(t^2 - w*t - 3*w^2)*x^2 + 12*t*(t^2 + 3*w*t - 3*w^2)*x + 4*t*(t^2 + 3*t - 3)),
  4*t/(t^2 - 6*t - 3) * y*((t^2 - 6*t - 3)*x^3 - 3*x*(t^2 + 3*t*w - 3*w^2) - 2*(t^2 + 3*t - 3))/(4*t*(t^2 - 6*t - 3)*x^3 - 3*w*(t^2 - 6*t - 3)*(t^2 - w*t - 3*w^2)*x^2 + 12*t*(t^2 + 3*w*t - 3*w^2)*x + 4*t*(t^2 + 3*t - 3))^2
]>;
f2:=map<C->E2|[
 -1/(t^2 + (w^2 - 1)*t + 3*w^2) * ((t^2 + 3*t*w - 3*w^2)*x + t^2 + 3*t - 3)^2*(4*(t^4 - 3*t^3 + 3*t^2 + 9*t + 9)*x + (t^2 + 3*t - 3)*(t^2 + 3*w^2*t - 3*w))/(4*(t^2 - 6*t - 3)*(t^2 + 3*t - 3)*x^3 + 9*(t^2 + 3*w*t - 3*w^2)^2*x^2 + 6*(t^2 + 3*t - 3)*(t^2 + 3*w*t - 3*w^2)*x + (t^2 + 3*t - 3)^2),
 12*(1 + 2*w)*t/((t^2 + (w^2 - 1)*t + 3*w^2)^2*(t^2 - 6*t - 3)) * y*(3*w*(t^2 + 3*t - 3)*(t^3 - 3*t^2 - 3*t*(4 + 3*w) - 9*w)*(t^3 - (3 + 4*w)*t^2 + 3*w*t + 3*w)*x^2 + x^3*(9*t^8*w - 45*t^7*w + 81*t^6*w - 27*t^5*w - 81*t^3*w - 729*t^2*w + 17*t^7 - 27*t^6 - 99*t^5 + 540*t^4 + 216*t^3 - 972*t^2 - 1215*t*w - 1674*t - 729*w - 729) - 3*t*(t^2 + 3*t - 3)^2*x*(t^2 + 3*t*w + 3*w + 3) - t*(t^2 + 3*t - 3)^3)/(4*(t^2 - 6*t - 3)*(t^2 + 3*t - 3)*x^3 + 9*(t^2 + 3*w*t - 3*w^2)^2*x^2 + 6*(t^2 + 3*t - 3)*(t^2 + 3*w*t - 3*w^2)*x + (t^2 + 3*t - 3)^2)^2
]>;

// an isomorphism between the two elliptic curves
iso:=map<E1->E2|[ w^2*(t^2 + (w^2-1)*t + 3*w^2)*x - (w+2)*(t-1)*(t+3), (t^2 + (w^2-1)*t + 3*w^2)*y ]>;

R<X>:=PolynomialRing(K);
h:=hom<Parent(x)->R | [X,0] >;
j:=jInvariant(EllipticCurve(h(Basis(Ideal(E1))[1])));
j eq 27*(t - 3)^3*(t + 1)^3/t^3;
